<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Groq Code Assistant</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-r from-indigo-100 via-purple-100 to-pink-100 min-h-screen text-gray-800 font-sans">
  <div class="max-w-4xl mx-auto mt-12 p-8 bg-white rounded-3xl shadow-2xl border border-gray-200">
    <h1 class="text-4xl font-extrabold text-center text-indigo-700 mb-8">🚀 Groq Code Assistant</h1>

    <!-- Input Section -->
    <div class="space-y-6">
      <!-- Image upload -->
      <div class="border-dashed border-4 border-indigo-300 rounded-xl p-6 text-center hover:bg-indigo-50 transition cursor-pointer" id="dropZone">
        <p class="text-gray-600">📷 Drag & Drop your image here or click to select</p>
        <input type="file" id="image" accept="image/*" class="hidden">
      </div>

      <!-- Text input -->
      <div>
        <label class="block text-lg font-semibold text-gray-700 mb-1">📝 Or Paste Your Coding Problem</label>
        <textarea id="query" rows="4" class="w-full p-4 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-indigo-400 focus:outline-none" placeholder="Write a Python function to..."></textarea>
      </div>

      <!-- Submit button -->
      <button id="submitBtn" class="w-full bg-gradient-to-r from-indigo-500 to-purple-600 text-white py-3 rounded-xl text-lg font-semibold shadow-md hover:from-indigo-600 hover:to-purple-700 transition-all duration-300">
        🔍 Generate & Execute
      </button>
    </div>

    <!-- Response Section -->
    <div id="responseContainer" class="mt-10 space-y-6"></div>
  </div>

  <script>
    const dropZone = document.getElementById("dropZone");
    const imageInput = document.getElementById("image");
    const responseContainer = document.getElementById("responseContainer");

    // Click to open file picker
    dropZone.addEventListener("click", () => imageInput.click());

    // Drag & drop
    dropZone.addEventListener("dragover", (e) => {
      e.preventDefault();
      dropZone.classList.add("bg-indigo-50");
    });
    dropZone.addEventListener("dragleave", () => dropZone.classList.remove("bg-indigo-50"));
    dropZone.addEventListener("drop", (e) => {
      e.preventDefault();
      dropZone.classList.remove("bg-indigo-50");
      if (e.dataTransfer.files.length > 0) {
        imageInput.files = e.dataTransfer.files;
      }
    });

    // Submit handler
    document.getElementById("submitBtn").addEventListener("click", async (e) => {
      e.preventDefault();
      const query = document.getElementById("query").value.trim();
      responseContainer.innerHTML = "<p class='text-gray-500'>Processing...</p>";

      try {
        let res;
        if (imageInput.files.length > 0) {
          const formData = new FormData();
          formData.append("image", imageInput.files[0]);
          if (query) formData.append("query", query);
          res = await fetch("/chat", { method: "POST", body: formData });
        } else {
          res = await fetch("/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message: query }),
          });
        }

        if (!res.ok) throw new Error("Server error: " + res.status);
        const data = await res.json();

        // Extract sections
        const extractedText = data.response.match(/<h2>📄 Extracted Text.*?<\/h2><pre>([\s\S]*?)<\/pre>/)?.[1] || 'No extracted text';
        const suggestedCode = data.response.match(/<h2>💡 Suggested Python Solution.*?<\/h2><pre>([\s\S]*?)<\/pre>/)?.[1] || 'No solution';

        // Display results (without Output section)
        responseContainer.innerHTML = `
          <div class="space-y-4">
            <details class="bg-gray-50 border border-gray-300 rounded-lg p-4">
              <summary class="font-semibold text-indigo-700 cursor-pointer text-lg">📄 Extracted Text from Image</summary>
              <pre class="max-h-60 overflow-y-auto mt-2 text-sm whitespace-pre-wrap">${extractedText}</pre>
            </details>

            <details class="bg-gray-50 border border-gray-300 rounded-lg p-4">
              <summary class="font-semibold text-indigo-700 cursor-pointer text-lg">💡 Suggested Python Solution & Explanation</summary>
              <pre class="max-h-80 overflow-y-auto mt-2 text-sm font-mono whitespace-pre-wrap">${suggestedCode}</pre>
            </details>
          </div>
        `;

        // Clear inputs
        imageInput.value = "";
        document.getElementById("query").value = "";
      } catch (err) {
        responseContainer.innerHTML = `<p class="text-red-600">⚠️ Error: ${err.message}</p>`;
        imageInput.value = "";
      }
    });
  </script>
</body>
</html>
